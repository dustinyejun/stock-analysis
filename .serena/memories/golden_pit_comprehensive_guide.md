# 黄金坑规则完整指南

## 📋 项目概述

### 升级背景
用户基于实际K线图形分析，发现原有黄金坑选股逻辑过于复杂：
- 原逻辑需要4个条件同时满足（深度回调+大阳线+均线突破+放量）
- 强制要求大阳线突破，忽略了温和突破的情况
- 强制要求放量确认，错过了存量资金推动的机会

### 升级目标
- 简化为2个核心条件：深度回调 + 站上10日均线
- 提高对温和突破和存量资金推动机会的识别能力
- 更符合技术分析的直观判断逻辑

## 🎯 新版本逻辑详解

### 核心判断条件

#### 条件1：深度回调检测
- **标准**：从前期高点（60日内）回调≥20%
- **计算**：(当前价 - 前期高点) / 前期高点 ≤ -20%
- **代码实现**：
```python
max_drawdown = indicators['drawdown_60'].min()
drawdown_condition = abs(max_drawdown) >= drawdown_threshold
```

#### 条件2：均线突破确认
- **标准**：当前股价 > 10日移动平均线
- **要求**：收盘价站上，不要求缺口突破
- **代码实现**：
```python
current_price = latest_data['close']
ma_value = latest_data['ma10']
ma_breakout = current_price > ma_value
```

### 评分机制
- **回调深度评分**（50%权重）：40分 + (实际回调-20%) × 200
- **突破幅度评分**（50%权重）：50分 + 突破幅度 × 500
- **通过标准**：两个核心条件都必须满足
  - ≥75分：PASS（高质量机会，置信度90%）
  - 50-74分：PARTIAL（一般机会，置信度70%）
  - <50分：FAIL（不符合条件）

## 🔧 技术实现详情

### 代码修改清单

#### 1. 核心规则文件 (src/rules/golden_pit.py)
- ✅ **类注释更新**：说明简化逻辑特点
- ✅ **__init__方法简化**：移除冗余参数，保留核心配置
- ✅ **check_conditions重构**：从4条件简化为2条件
- ✅ **评分机制优化**：调整权重和阈值
- ✅ **规则描述更新**：反映新的判断逻辑

#### 2. 配置文件 (config/settings.py)
- ✅ **保留参数**：
  - `golden_pit_decline_threshold: -0.20` # 回调阈值
  - `golden_pit_lookback_days: 60` # 前期高点回看天数
- ✅ **移除参数**：
  - `golden_pit_volume_ratio` # 不再强制要求放量
  - `golden_pit_big_yang_threshold` # 不再要求大阳线

#### 3. Web界面 (app.py)
- ✅ **帮助文本更新**：改为"检测深度回调后重新站上均线的机会（简化版）"
- ✅ **表格列优化**：将"大阳线涨幅"改为"突破幅度"

### 技术指标依赖
**必需指标**：
- `ma10`: 10日移动平均线
- `high_60`: 60日最高点
- `drawdown_60`: 60日回调幅度

**不再需要**：
- `big_yang`, `volume_ratio_5`, `consecutive_yang`, `volume_expansion`

## 📊 测试验证结果

### 功能测试
- ✅ Python语法检查通过
- ✅ 规则逻辑执行正常
- ✅ 边界条件处理正确
- ✅ 系统兼容性验证

### 实际数据测试
```
测试场景：前期高点3.55，当前价3.19，10日均线3.08，最大回调-21.1%
执行结果：PARTIAL (54.8分)
条件验证：
  - 深度回调：✅ (-21.1% ≥ -20%)
  - 均线突破：✅ (3.19 > 3.08)
  - 综合判断：✅ 两个条件都满足
```

## 💡 使用指南

### 适用场景
**推荐使用**：
- 温和反弹行情：股价缓慢回升突破均线
- 存量资金推动：无明显放量但价格突破
- 早期机会捕捉：在强势确认之前提前布局
- 技术修复行情：深度调整后的技术性反弹

**不适用场景**：
- 震荡市场：频繁上下穿越均线
- 超短期操作：持股周期少于10个交易日
- 纯题材驱动：基本面或消息面主导的行情

### 操作建议
- **入场时机**：突破10日均线当天或次日
- **加仓时机**：突破后回踩均线不破时
- **止损位置**：跌破前期重要低点
- **仓位控制**：单只股票建议3-5%总仓位

### 参数调优
```python
# 可调整参数
{
    'drawdown_threshold': 0.20,      # 回调阈值（可调整15%-25%）
    'ma_period': 10,                 # 均线周期（可选5/10/20日）
    'high_lookback_period': 60,      # 回看周期（可调整30-120日）
}

# 阈值设置
{
    'min_score': 50.0,               # 最低通过分数
    'high_score': 75.0,              # 高分阈值
}
```

## 📈 效果对比

| 对比维度 | 原版本 | 新版本（简化版） |
|----------|--------|------------------|
| 判断条件 | 4个复杂条件 | 2个核心条件 |
| 大阳线要求 | 必须（涨幅≥5%，量比≥1.5） | 不要求 |
| 成交量要求 | 必须（量比≥1.3） | 不要求 |
| 最低分数线 | 60分 | 50分 |
| 高分阈值 | 85分 | 75分 |
| 选股灵敏度 | 较低（严格） | 较高（灵敏） |
| 适用场景 | 强势突破 | 强势+温和突破 |
| 计算复杂度 | 高 | 低 |

## 🔄 维护说明

### 监控要点
1. **选股结果质量**：观察新逻辑的选股准确率
2. **市场适应性**：在不同市场环境下的表现
3. **用户反馈**：收集实际使用体验

### 优化建议
- 根据市场表现调整回调阈值
- 考虑季节性或市场周期因素
- 必要时可增加可选辅助条件

### 风险控制
- 保留原版本代码备份便于回滚
- 支持参数灵活调整
- 建立效果跟踪机制

## 📝 项目总结

### 主要成果
✅ **逻辑简化**：4条件→2条件，提高实用性
✅ **覆盖提升**：捕捉更多温和突破机会
✅ **体验优化**：更符合技术分析直觉
✅ **性能改进**：减少计算复杂度

### 技术亮点
- 保持核心技术分析逻辑的同时简化判断条件
- 成功平衡选股灵敏度和质量标准
- 实现向前兼容，无需数据迁移
- 提供完整的参数调优空间

黄金坑规则简化升级项目已圆满完成，新逻辑能够更好地识别深度回调后重新站上10日均线的投资机会，为用户提供更实用的选股工具。