# A股选股系统 - 技术规范

## 技术栈架构

### 核心技术栈
- **Python**: 3.11+ (开发语言)
- **数据处理**: pandas (>=2.3.0), numpy (>=1.24.0)
- **数据源**: akshare (>=1.17.0), yfinance (>=0.2.0)
- **Web界面**: Streamlit (>=1.48.0)
- **数据验证**: Pydantic (>=2.11.0)
- **日志系统**: loguru (>=0.7.0)
- **打包工具**: PyInstaller (>=5.13.0)

### 开发工具
- **环境管理**: python-dotenv (>=1.0.0)
- **HTTP客户端**: requests (>=2.31.0)
- **测试框架**: pytest (>=7.4.0)
- **打包界面**: auto-py-to-exe (>=2.38.0)

### 系统要求
- **操作系统**: Windows 10/11, macOS, Linux
- **Python版本**: 3.11或更高
- **运行内存**: 推荐4GB以上
- **存储空间**: 至少2GB可用空间
- **网络连接**: 必需（获取实时股票数据）

## 项目结构

### 目录组织
```
stock-analysis/
├── src/                           # 核心源代码
│   ├── __init__.py
│   ├── data_fetcher.py           # 数据获取模块
│   ├── indicators.py             # 技术指标计算
│   ├── selection_rules.py        # 选股规则框架
│   ├── stock_selector.py         # 选股引擎
│   └── rules/                    # 具体规则实现
│       ├── __init__.py
│       ├── golden_pit.py         # 黄金坑规则
│       └── trend_breakout.py     # 趋势突破规则
├── config/                       # 配置文件
│   └── settings.py              # 应用配置
├── tests/                       # 测试文件
├── logs/                        # 日志文件目录
├── app.py                       # Streamlit主程序
├── run_app.py                   # EXE启动文件
├── requirements.txt             # Python依赖
├── app.spec                     # PyInstaller配置
└── build_exe.bat               # 打包脚本
```

### 核心模块设计
1. **StockDataFetcher** - 股票数据获取器
   - 支持A股全市场数据获取
   - 智能重试和缓存机制
   - 数据质量验证

2. **TechnicalIndicators** - 技术指标计算器
   - 24种专业技术指标
   - 向量化高效计算
   - 指标验证系统

3. **StockSelector** - 选股引擎
   - 规则引擎架构
   - 多线程并发处理
   - 综合评分排序

4. **StockSelectionApp** - Web界面
   - Streamlit现代化UI
   - 实时交互体验
   - 多维度结果展示

## 编码规范

### 代码质量标准
- **代码风格**: 严格遵循PEP8标准
- **类型提示**: 所有函数必须使用类型注解
- **文档字符串**: 所有公开接口必须有详细docstring
- **错误处理**: 使用结构化异常处理和日志记录
- **单元测试**: 核心功能必须有测试覆盖

### 设计模式应用
- **策略模式**: 选股规则的多态实现
- **工厂模式**: 数据获取器和指标计算器创建
- **装饰器模式**: 重试机制和性能监控
- **配置模式**: Pydantic数据验证和配置管理

### 性能优化原则
- **向量化计算**: 使用pandas/numpy批量操作
- **并发处理**: ThreadPoolExecutor多线程数据获取
- **内存管理**: 及时释放大数据对象
- **缓存策略**: 智能缓存机制避免重复计算

## 架构设计

### 分层架构
1. **数据获取层** - 负责股票数据获取和预处理
2. **计算引擎层** - 技术指标计算和数据转换
3. **规则引擎层** - 选股规则逻辑和评分算法
4. **Web界面层** - 用户交互和结果展示
5. **配置管理层** - 应用配置和参数管理

### 核心接口
- `BaseSelectionRule`: 选股规则抽象基类
- `SelectionResult`: 规则执行结果标准格式
- `RuleConfig`: 规则配置管理接口
- `TechnicalIndicators`: 技术指标计算接口

## EXE打包规范

### 打包配置
- **打包工具**: PyInstaller + auto-py-to-exe
- **目标格式**: 单文件EXE (--onefile)
- **图标配置**: 自定义应用图标
- **依赖处理**: 自动收集所有必要依赖

### 优化策略
- **启动优化**: 最小化启动时间
- **体积控制**: 排除不必要的库文件
- **兼容性**: 支持Windows 10/11系统
- **安全性**: 数字签名和杀毒软件兼容

### 交付标准
- **文件大小**: 目标50-150MB
- **启动时间**: 首次启动<15秒，后续<5秒
- **运行稳定性**: 无内存泄漏，长期稳定运行
- **用户体验**: 双击启动，操作简单直观

## 质量保证

### 测试策略
- **单元测试**: 核心算法和数据处理逻辑
- **集成测试**: 模块间接口和数据流
- **功能测试**: 完整选股流程验证
- **性能测试**: 大数据量处理能力验证

### 监控指标
- **数据准确性**: 技术指标计算精度≥99.9%
- **系统稳定性**: 连续运行无崩溃
- **响应性能**: UI交互响应时间<3秒
- **资源占用**: 内存占用<2GB，CPU占用合理

这些技术规范确保了A股选股系统的专业性、稳定性和可维护性，为用户提供企业级的选股分析工具。